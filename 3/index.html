<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë©”ì´ë“œ ì¹´í˜ ì£¼ë¬¸í•˜ê¸° â¤ï¸</title>
    
    <!-- ê·€ì—¬ìš´ í°íŠ¸ ì¶”ê°€ (Jua, Gaegu) -->
    <link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&family=Jua&display=swap" rel="stylesheet">

    <style>
        :root {
            --main-pink: #ff80ab;
            --dark-pink: #d81b60;
            --light-pink: #ffe4f0;
            --bg-color: #fff0f5;
        }

        body { 
            font-family: 'Jua', sans-serif; /* ê·€ì—¬ìš´ ì œëª© í°íŠ¸ */
            background-color: var(--bg-color);
            /* ë•¡ë•¡ì´ ë°°ê²½ íŒ¨í„´ */
            background-image: radial-gradient(#ffc1e3 15%, transparent 16%), radial-gradient(#ffc1e3 15%, transparent 16%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            
            padding: 20px; 
            text-align: center; 
            margin: 0;
            color: #444;
        }

        h2 { 
            font-family: 'Jua', sans-serif;
            color: var(--dark-pink); 
            font-size: 28px;
            margin-bottom: 5px; 
            text-shadow: 2px 2px 0px #fff;
        }
        
        p.subtitle { 
            font-family: 'Gaegu', cursive;
            font-size: 18px; 
            color: #666; 
            margin-bottom: 25px; 
            background: rgba(255,255,255,0.6);
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
        }
        
        /* í…Œì´ë¸” ë²ˆí˜¸ ì…ë ¥ ë°•ìŠ¤ */
        .table-input-box { 
            background: white; 
            padding: 15px 25px; 
            border-radius: 25px; 
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(216, 27, 96, 0.15); 
            border: 3px solid var(--light-pink);
            margin-bottom: 25px;
        }
        .table-input-box label { font-size: 20px; color: var(--dark-pink); }
        input { 
            font-family: 'Jua', sans-serif;
            font-size: 22px; 
            padding: 5px; 
            width: 70px; 
            text-align: center; 
            border: 2px solid var(--main-pink); 
            border-radius: 12px; 
            color: var(--dark-pink);
            outline: none;
        }
        input:focus { box-shadow: 0 0 0 3px var(--light-pink); }

        .menu-container { 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
            max-width: 600px;
            margin: 0 auto;
        }

        /* ë©”ë‰´ ì•„ì´í…œ ì¹´ë“œ */
        .menu-item { 
            background: rgba(255, 255, 255, 0.95); 
            border: 2px dashed var(--main-pink); /* ìŠ¤í‹°ì¹˜ íš¨ê³¼ */
            border-radius: 20px; 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            align-items: flex-start; 
            text-align: left;
            box-shadow: 0 5px 10px rgba(216, 27, 96, 0.05);
            transition: transform 0.2s;
            position: relative;
            overflow: hidden;
        }
        .menu-item:hover { transform: translateY(-3px); }

        .menu-name { 
            font-size: 19px; 
            color: #333; 
            margin-bottom: 8px; 
            line-height: 1.3;
            word-break: keep-all;
        }
        .menu-desc { font-size: 14px; color: #888; font-family: 'Apple SD Gothic Neo', sans-serif; } /* ì„¤ëª…ì€ ê°€ë…ì„± ì¢‹ê²Œ */
        
        .price-tag {
            background-color: var(--light-pink);
            color: var(--dark-pink);
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: bold;
            display: inline-block;
            margin-top: 5px;
        }

        /* ìˆ˜ëŸ‰ ì¡°ì ˆ ë²„íŠ¼ ì˜ì—­ */
        .controls { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            align-self: flex-end; 
            margin-top: 10px; 
            background: #fff;
            padding: 5px;
            border-radius: 30px;
            border: 1px solid #eee;
        }
        .btn-count { 
            width: 34px; height: 34px; border-radius: 50%; border: none; 
            font-size: 20px; cursor: pointer; 
            display: flex; align-items: center; justify-content: center;
            transition: all 0.1s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .btn-count:active { transform: scale(0.9); }
        
        .btn-minus { background: #f0f0f0; color: #888; }
        .btn-plus { background: var(--main-pink); color: white; }
        
        .count-display { 
            font-size: 20px; 
            font-weight: bold; 
            width: 25px; 
            text-align: center; 
            color: #333;
        }

        /* í•˜ë‹¨ ì¥ë°”êµ¬ë‹ˆ ë°” */
        #cartBar {
            position: fixed; bottom: 20px; left: 50%; 
            transform: translateX(-50%);
            width: 90%; max-width: 500px;
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(5px);
            padding: 15px 25px; 
            border-radius: 35px;
            border: 2px solid var(--main-pink);
            box-shadow: 0 10px 25px rgba(216, 27, 96, 0.2); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            box-sizing: border-box;
            z-index: 100;
        }
        
        #totalCount { 
            font-size: 18px; 
            color: var(--dark-pink); 
        }

        #orderBtn { 
            background: linear-gradient(135deg, #ff80ab, #d81b60);
            color: white; 
            border: none; 
            padding: 12px 25px; 
            font-family: 'Jua', sans-serif;
            font-size: 20px; 
            border-radius: 25px; 
            cursor: pointer; 
            box-shadow: 0 4px 10px rgba(216, 27, 96, 0.3);
            transition: transform 0.2s;
            animation: pulse 2s infinite;
        }
        #orderBtn:active { transform: scale(0.95); }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .spacer { height: 100px; } 

        /* ì•Œë¦¼ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ (ë¸Œë¼ìš°ì € ê¸°ë³¸ alert ëŒ€ì‹  ì´ì˜ê²Œ í•˜ê³  ì‹¶ë‹¤ë©´ ì¶”ê°€ êµ¬í˜„ í•„ìš”í•˜ì§€ë§Œ, ê¸°ë³¸ì ìœ¼ë¡œëŠ” CSSë§Œ ìˆ˜ì •) */
    </style>
</head>
<body>

    <h2>ğŸ€ ë©”ì´ë“œ ì¹´í˜ ì£¼ë¬¸ ğŸ€</h2>
    <p class="subtitle">ëª¨ë“  ë©”ë‰´ëŠ” ì£¼ì¸ë‹˜ì„ ìœ„í•´ ë¬´ë£Œì…ë‹ˆë‹¤ (Free) âœ¨</p>
    
    <div class="table-input-box">
        <label>Table No.</label>
        <input type="number" id="tableNo" placeholder="?" inputmode="numeric">
    </div>

    <div id="menuList" class="menu-container"></div>
    <div class="spacer"></div>

    <div id="cartBar" style="display:none;">
        <span id="totalCount">ì´ 0ê°œ ì„ íƒë¨</span>
        <button id="orderBtn" onclick="sendOrder()">ì£¼ë¬¸í•˜ê¸° â¤ï¸</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC5lLY7p09aqglYrqYEF6hBBRxIOaB59Uk",
            authDomain: "madecafe-85738.firebaseapp.com",
            projectId: "madecafe-85738",
            storageBucket: "madecafe-85738.firebasestorage.app",
            messagingSenderId: "481793894590",
            appId: "1:481793894590:web:00873d3f6285c87d6756ef",
            measurementId: "G-HVE60ZL3XZ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const menus = [
            { id: 1, name: "ì´ˆì½”íŒŒì´ë¥¼ ê³ ë°±ìš©ìœ¼ë¡œ ì“°ì§€ ë§ì•„ì£¼ì„¸ìš” ì œë°œ ğŸ˜¢", limit: 2 },
            { id: 2, name: "ì£¼ì¸ë‹˜ ì˜¤ëŠ˜ì€ ë ˆëª¬ë•…ì˜ ì¶•ë³µì„! ë©”ì§€ì»¬ ì—.ì´.ë“œ. ğŸ‹", limit: 2 },
            { id: 3, name: "ë§ˆì‹œë©´ ê¸°ë¶„ì´ Highí•´ì§€ëŠ” ë©”ì´ë“œì§±ì˜ ì˜ë¬¸ì˜ ëŸ¬ë¸”ë¦¬ ì•¡ì²´ë“¤ ğŸ§ª", limit: 2 },
            { id: 4, name: "ê°•ëƒ‰ì´ë¥¼ ë°”ë¼ë³´ì ê°•ëƒ‰ì´ê°€ ë‚˜ë¥¼ ì‘ì‹œí–ˆë‹¤ ğŸ‘€", limit: 2 },
            { id: 5, name: "ë‘ê·¼ë‘ê·¼ ë£°ë › (ê±°ë¶€ê¶Œ ì—†ìŒ! ì¢‹ì€ ê±¸ì§€ë„..?) ğŸŠ", limit: 2 },
            { id: 6, name: "ë©”ì´ë“œì§±ì˜ ìŠ¤í˜ì…œ ì„œë¹„ìŠ¤ íƒ€ì„ê³¼ ì• êµ? ğŸ˜³", limit: 999 }
        ];

        let cart = {}; 

        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const tableParam = urlParams.get('table');
            if(tableParam) document.getElementById('tableNo').value = tableParam;
            renderMenu();
        };

        function renderMenu() {
            const container = document.getElementById('menuList');
            container.innerHTML = menus.map(menu => `
                <div class="menu-item">
                    <div class="menu-name">${menu.name}</div>
                    <div class="price-tag">
                        Free 
                        ${menu.limit < 10 ? `<span style="font-weight:normal; opacity:0.8; font-size:12px;">(ìµœëŒ€ ${menu.limit}ê°œ)</span>` : ''}
                    </div>
                    <div class="controls">
                        <button class="btn-count btn-minus" onclick="changeCount(${menu.id}, -1)">âˆ’</button>
                        <span class="count-display" id="cnt-${menu.id}">0</span>
                        <button class="btn-count btn-plus" onclick="changeCount(${menu.id}, 1)">ï¼‹</button>
                    </div>
                </div>
            `).join('');
        }

        window.changeCount = (id, delta) => {
            const menu = menus.find(m => m.id === id);
            const currentQty = cart[id] || 0;
            const newQty = currentQty + delta;

            if (newQty < 0) return;
            if (newQty > menu.limit) {
                alert(`"${menu.name.substring(0, 8)}..." \nì´ ë©”ë‰´ëŠ” 1ì¸ë‹¹ ìµœëŒ€ ${menu.limit}ê°œê¹Œì§€ë§Œ ê°€ëŠ¥í•´ìš”! ğŸ˜¢`);
                return;
            }

            if (newQty === 0) delete cart[id];
            else cart[id] = newQty;

            document.getElementById(`cnt-${id}`).innerText = newQty;
            updateTotal();
        }

        function updateTotal() {
            const total = Object.values(cart).reduce((a, b) => a + b, 0);
            document.getElementById('totalCount').innerText = `ì´ ${total}ê°œ ì„ íƒë¨`;
            
            // 0ê°œì¼ ë•ŒëŠ” í•˜ë‹¨ ë°” ìˆ¨ê¸°ê¸°, 1ê°œ ì´ìƒì¼ ë•Œ ë¶€ë“œëŸ½ê²Œ ë³´ì´ê¸°
            const cartBar = document.getElementById('cartBar');
            if(total > 0) {
                cartBar.style.display = 'flex';
            } else {
                cartBar.style.display = 'none';
            }
        }

        window.sendOrder = async () => {
            const tableNo = document.getElementById('tableNo').value;
            const total = Object.values(cart).reduce((a, b) => a + b, 0);

            if(!tableNo) return alert("ì£¼ì¸ë‹˜! í…Œì´ë¸” ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì…”ì•¼ í•´ìš”! ğŸ’¦");
            if(total === 0) return alert("ë©”ë‰´ë¥¼ í•˜ë‚˜ë¼ë„ ì„ íƒí•´ì£¼ì„¸ìš”! â¤ï¸");

            const orderItems = Object.keys(cart).map(id => {
                const menu = menus.find(m => m.id == id);
                return `${menu.name} x${cart[id]}`;
            });

            if(confirm(`[Table ${tableNo}] ì£¼ë¬¸í•˜ì‹œê² ì–´ìš”? â¤ï¸`)) {
                try {
                    await addDoc(collection(db, "orders"), {
                        table: tableNo,
                        menu: orderItems,
                        status: "ì ‘ìˆ˜",
                        time: serverTimestamp()
                    });
                    alert("ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤! \nì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš” ì£¼ì¸ë‹˜ â¤ï¸");
                    location.reload(); 
                } catch (e) {
                    alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš” ã… ã… : " + e.message);
                }
            }
        }
    </script>
</body>
</html>d
