<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ë°© ì£¼ë¬¸ í˜„í™© ğŸ‘©â€ğŸ³</title>
    
    <!-- ê·€ì—¬ìš´ í°íŠ¸ ì¶”ê°€ (Jua) -->
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-dark: #2c2c2c;
            --card-bg: #ffffff;
            --accent-pink: #ff80ab;
            --strong-pink: #d81b60;
            --text-dark: #333;
        }

        body { 
            font-family: 'Jua', sans-serif; 
            padding: 20px; 
            background-color: var(--bg-dark); 
            color: white; 
            margin: 0;
        }

        h1 {
            text-align: center;
            color: var(--accent-pink);
            font-size: 32px;
            margin-bottom: 30px;
            text-shadow: 2px 2px 0px #000;
        }
        
        h1 span { font-size: 24px; color: #aaa; vertical-align: middle; margin-left: 10px; }

        /* ì£¼ë¬¸ ë¦¬ìŠ¤íŠ¸ ê·¸ë¦¬ë“œ (ë°˜ì‘í˜•) */
        #orderList {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ì£¼ë¬¸ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .order-card { 
            background: var(--card-bg); 
            color: var(--text-dark); 
            border-radius: 15px; 
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            display: flex; 
            flex-direction: column;
            animation: popIn 0.3s ease-out;
            border-top: 6px solid var(--accent-pink);
        }

        @keyframes popIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* ì¹´ë“œ í—¤ë” (í…Œì´ë¸” ë²ˆí˜¸ + ì‹œê°„) */
        .card-header {
            background: #fff0f5;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px dashed #ffc1e3;
        }

        .table-num { 
            font-weight: bold; 
            color: var(--strong-pink); 
            font-size: 1.8rem; 
        }
        
        .order-time {
            font-size: 0.9rem;
            color: #888;
            background: white;
            padding: 3px 8px;
            border-radius: 10px;
            border: 1px solid #ddd;
        }

        /* ë©”ë‰´ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ */
        .menu-list { 
            padding: 20px; 
            font-size: 1.2rem; 
            line-height: 1.6;
            flex-grow: 1; /* ë‚´ìš©ì´ ì ì–´ë„ ë²„íŠ¼ì„ ì•„ë˜ë¡œ ë°€ì–´ëƒ„ */
        }
        .menu-item { display: block; margin-bottom: 5px; word-break: keep-all; }
        .menu-item::before { content: "ğŸ° "; }

        /* ì™„ë£Œ ë²„íŠ¼ */
        .btn-done { 
            background: var(--strong-pink); 
            color: white; 
            border: none; 
            padding: 15px; 
            cursor: pointer; 
            font-size: 1.3rem; 
            font-family: 'Jua', sans-serif;
            transition: background 0.2s;
            width: 100%;
        }
        .btn-done:hover { background: #ad1457; }
        .btn-done:active { transform: translateY(2px); }

        /* ëŒ€ê¸° ì¤‘ ë©”ì‹œì§€ */
        .empty-message {
            grid-column: 1 / -1;
            text-align: center;
            padding: 50px;
            color: #777;
            font-size: 1.5rem;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”¥ Kitchen Display <span>ë§›ìˆì–´ì§€ëŠ” ì£¼ë¬¸ë“¤</span></h1>
    <div id="orderList">
        <!-- ì£¼ë¬¸ ì¹´ë“œê°€ ì—¬ê¸°ì— ë“¤ì–´ê°‘ë‹ˆë‹¤ -->
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, onSnapshot, doc, deleteDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC5lLY7p09aqglYrqYEF6hBBRxIOaB59Uk",
            authDomain: "madecafe-85738.firebaseapp.com",
            projectId: "madecafe-85738",
            storageBucket: "madecafe-85738.firebasestorage.app",
            messagingSenderId: "481793894590",
            appId: "1:481793894590:web:00873d3f6285c87d6756ef",
            measurementId: "G-HVE60ZL3XZ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const orderList = document.getElementById('orderList');

        const q = query(collection(db, "orders"), orderBy("time", "asc"));
        
        onSnapshot(q, (snapshot) => {
            orderList.innerHTML = ""; 
            if(snapshot.empty) {
                orderList.innerHTML = `
                    <div class="empty-message">
                        í˜„ì¬ ëŒ€ê¸° ì¤‘ì¸ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.<br>
                        ì£¼ì¸ë‹˜ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘... ğŸ’¤
                    </div>
                `;
                return;
            }

            snapshot.forEach((docSnap) => {
                const data = docSnap.data();
                const id = docSnap.id;
                
                // ì‹œê°„ í¬ë§·íŒ… (Timestamp -> 00:00)
                let timeString = "ë°©ê¸ˆ ì „";
                if(data.time) {
                    const date = data.time.toDate();
                    const hours = String(date.getHours()).padStart(2, '0');
                    const minutes = String(date.getMinutes()).padStart(2, '0');
                    timeString = `${hours}:${minutes}`;
                }

                // ë©”ë‰´ ë°°ì—´ì„ ì¤„ë°”ê¿ˆ íƒœê·¸ë¡œ ë³€í™˜
                const menuHtml = data.menu.map(m => `<span class="menu-item">${m}</span>`).join('');
                
                const html = `
                    <div class="order-card">
                        <div class="card-header">
                            <span class="table-num">Table ${data.table}</span>
                            <span class="order-time">ğŸ•’ ${timeString}</span>
                        </div>
                        <div class="menu-list">
                            ${menuHtml}
                        </div>
                        <button class="btn-done" onclick="completeOrder('${id}')">ì¡°ë¦¬ ì™„ë£Œ (Done) âœ…</button>
                    </div>
                `;
                orderList.innerHTML += html;
            });
        });

        window.completeOrder = async (id) => {
            // ì£¼ë°©ì€ ë°”ì˜ë‹ˆê¹Œ confirm ì—†ì´ ë°”ë¡œ ì‚­ì œí•˜ê±°ë‚˜, 
            // ì‹¤ìˆ˜ ë°©ì§€ë¥¼ ìœ„í•´ confirmì„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„  ìœ ì§€í–ˆìŠµë‹ˆë‹¤.
            if(confirm("ì´ ì£¼ë¬¸ì„ ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                try {
                    await deleteDoc(doc(db, "orders", id));
                } catch(e) {
                    alert("ì˜¤ë¥˜: " + e.message);
                }
            }
        }
    </script>
</body>
</html>
