<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì£¼ë°© ë””ìŠ¤í”Œë ˆì´ ğŸ‘©â€ğŸ³</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        :root { --bg-dark: #222; --card-bg: #fff; --accent-pink: #ff80ab; --strong-pink: #c2185b; }
        * { box-sizing: border-box; }

        body { 
            font-family: 'Jua', sans-serif; 
            background-color: #222;
            /* ì‚¬ì„  ì¤„ë¬´ëŠ¬ íŒ¨í„´ */
            background-image: repeating-linear-gradient(
                45deg,
                #222,
                #222 10px,
                #2d2024 10px, /* ì•„ì£¼ ì€ì€í•œ ë¶‰ì€ í†¤ */
                #2d2024 20px
            );

        h1 { 
            text-align: center; color: var(--accent-pink); 
            font-size: 26px; margin: 10px 0 25px 0; 
        }
        h1 span { font-size: 18px; color: #aaa; display: block; margin-top: 5px; }

        /* ğŸ”¥ [ë³€ê²½] ì‹œì‘ ì˜¤ë²„ë ˆì´ (ì „ì²´ í™”ë©´ ë®ê¸°) */
        #startOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 9999;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            backdrop-filter: blur(5px);
        }
        
        /* ğŸ˜œ í´ë¦­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .start-btn {
            font-family: 'Jua', sans-serif;
            font-size: 40px; color: white;
            background: var(--strong-pink);
            border: 4px solid var(--accent-pink);
            padding: 30px 60px; border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 0 30px rgba(255, 128, 171, 0.6);
            animation: bounce 1s infinite alternate;
        }
        .start-btn:active { transform: scale(0.95); }
        .start-msg { margin-top: 20px; font-size: 20px; color: #ddd; }

        @keyframes bounce { from { transform: scale(1); } to { transform: scale(1.1); } }

        /* ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
        #orderList { 
            display: grid; 
            grid-template-columns: 1fr; 
            gap: 15px; 
            max-width: 600px; margin: 0 auto; 
        }
        @media (min-width: 768px) {
            #orderList { grid-template-columns: 1fr 1fr; max-width: 1000px; }
        }

        /* ì£¼ë¬¸ ì¹´ë“œ */
        .order-card { 
            background: var(--card-bg); color: #333; border-radius: 12px; 
            overflow: hidden; display: flex; flex-direction: column; 
            border-top: 5px solid var(--accent-pink);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* ğŸš¨ í˜¸ì¶œ ì¹´ë“œ */
        .order-card.urgent {
            border: 4px solid #ff3d00; background: #fffde7;
            animation: pulseCard 0.8s infinite alternate;
        }
        @keyframes pulseCard { from { box-shadow: 0 0 10px #ff3d00; } to { box-shadow: 0 0 25px #ff3d00; } }

        .card-header { 
            background: #fff0f5; padding: 12px 15px; 
            display: flex; justify-content: space-between; align-items: center; 
            border-bottom: 1px dashed #ffc1e3; 
        }
        .table-num { font-size: 22px; color: var(--strong-pink); font-weight: bold; }
        .order-time { font-size: 14px; color: #777; background: #fff; padding: 4px 8px; border-radius: 8px; border: 1px solid #ddd; }

        .menu-list { 
            padding: 15px; flex-grow: 1; 
            display: flex; flex-direction: column; gap: 8px; 
        }
        .menu-item { 
            background: #fdf2f7; padding: 10px; border-radius: 8px; 
            font-size: 16px; line-height: 1.4; border-left: 4px solid var(--accent-pink); 
            word-break: keep-all; 
        }

        .note-box { 
            background: #fff9c4; color: #555; padding: 10px; margin: 0 15px 15px 15px; 
            border-radius: 8px; font-size: 14px; border: 1px dashed #fbc02d; 
        }
        .note-box::before { content: "ğŸ“¢ ìš”ì²­: "; font-weight: bold; color: #f57f17; }

        .btn-done { 
            background: var(--strong-pink); color: white; border: none; 
            padding: 15px; cursor: pointer; font-size: 18px; 
            font-family: 'Jua', sans-serif; width: 100%; 
        }
        .btn-done.call-btn { background: #ff9800; }
        
        .empty-message { text-align: center; padding: 60px 20px; color: #666; font-size: 18px; background: rgba(255,255,255,0.1); border-radius: 15px; border: 2px dashed #444; }
    </style>
</head>
<body>
    
    <!-- ğŸ”¥ [ë³€ê²½] ì „ì²´ í™”ë©´ í´ë¦­ ìœ ë„ ì˜¤ë²„ë ˆì´ -->
    <div id="startOverlay">
        <button class="start-btn" onclick="startKitchen()">í´ë¦­ğŸ’—</button>
        <div class="start-msg">ì£¼ë°©ì„ ì‹œì‘í•˜ë ¤ë©´ ëˆŒëŸ¬ì£¼ì„¸ìš”!</div>
    </div>

    <h1>ğŸ”¥ KITCHEN <span>ì£¼ë¬¸ í˜„í™©íŒ</span></h1>
    <audio id="alertSound" src="effect.mp3" preload="auto"></audio>

    <div id="orderList"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, onSnapshot, doc, deleteDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC5lLY7p09aqglYrqYEF6hBBRxIOaB59Uk",
            authDomain: "madecafe-85738.firebaseapp.com",
            projectId: "madecafe-85738",
            storageBucket: "madecafe-85738.firebasestorage.app",
            messagingSenderId: "481793894590",
            appId: "1:481793894590:web:00873d3f6285c87d6756ef",
            measurementId: "G-HVE60ZL3XZ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const orderList = document.getElementById('orderList');
        const q = query(collection(db, "orders"), orderBy("time", "asc"));

        let isSoundReady = false; // í´ë¦­í–ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ë³€ìˆ˜
        let isFirstLoad = true;
        const audio = document.getElementById('alertSound');

        // ğŸ”¥ [ë³€ê²½] "í´ë¦­ğŸ˜œ" ë²„íŠ¼ ëˆ„ë¥´ë©´ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
        window.startKitchen = () => {
            // 1. ë¹ˆ ì†Œë¦¬ë¥¼ í•œë²ˆ ì¬ìƒí•´ì„œ ë¸Œë¼ìš°ì € ê¶Œí•œì„ ëš«ìŒ
            audio.play().then(() => {
                audio.pause();
                audio.currentTime = 0;
            }).catch(e => console.log("ì˜¤ë””ì˜¤ ê¶Œí•œ í•„ìš”"));

            // 2. ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
            document.getElementById('startOverlay').style.display = 'none';
            isSoundReady = true; // ì´ì œ ì†Œë¦¬ ë‚¼ ì¤€ë¹„ ì™„ë£Œ
        };
        
        onSnapshot(q, (snapshot) => {
            // ğŸ”¥ [ë³€ê²½] 'í´ë¦­'ì„ í•œ ìƒíƒœì—¬ì•¼ë§Œ ì†Œë¦¬ê°€ ë‚¨
            if (!isFirstLoad && isSoundReady) {
                snapshot.docChanges().forEach((change) => {
                    if (change.type === "added") {
                        audio.currentTime = 0;
                        audio.play().catch(e => console.log('ì¬ìƒ ì‹¤íŒ¨:', e));
                    }
                });
            }

            orderList.innerHTML = ""; 
            if(snapshot.empty) {
                orderList.innerHTML = `<div class="empty-message">ëŒ€ê¸° ì¤‘ì¸ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤ ğŸ’¤</div>`;
                isFirstLoad = false;
                return;
            }

            snapshot.forEach((docSnap) => {
                const data = docSnap.data();
                const id = docSnap.id;
                
                let timeString = "ë°©ê¸ˆ";
                if(data.time) {
                    const date = data.time.toDate();
                    timeString = `${String(date.getHours()).padStart(2,'0')}:${String(date.getMinutes()).padStart(2,'0')}`;
                }

                let cardContent = '';
                
                if (data.type === 'call') {
                    cardContent = `
                        <div class="order-card urgent">
                            <div class="card-header">
                                <span class="table-num">ğŸš¨ Table ${data.table}</span>
                                <span class="order-time">${timeString}</span>
                            </div>
                            <div class="menu-list" style="text-align:center; justify-content:center; font-size:20px; font-weight:bold;">
                                ğŸ”” ë©”ì´ë“œ í˜¸ì¶œ!<br><span style="font-size:14px; color:#d84315;">(ë”©ë™~)</span>
                            </div>
                            <button class="btn-done call-btn" onclick="completeOrder('${id}', 'call')">í˜¸ì¶œ í™•ì¸ (ì™„ë£Œ)</button>
                        </div>
                    `;
                } else {
                    const menuHtml = data.menu ? data.menu.map(m => `<div class="menu-item">${m}</div>`).join('') : '';
                    const noteHtml = data.note ? `<div class="note-box">${data.note}</div>` : '';

                    cardContent = `
                        <div class="order-card">
                            <div class="card-header">
                                <span class="table-num">Table ${data.table}</span>
                                <span class="order-time">${timeString}</span>
                            </div>
                            <div class="menu-list">${menuHtml}</div>
                            ${noteHtml}
                            <button class="btn-done" onclick="completeOrder('${id}', 'order')">ì¡°ë¦¬ ì™„ë£Œ âœ…</button>
                        </div>
                    `;
                }
                orderList.innerHTML += cardContent;
            });
            isFirstLoad = false;
        });

        window.completeOrder = async (id, type) => {
            const msg = type === 'call' ? "í˜¸ì¶œ ê±´ì„ ë‹«ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?" : "ì£¼ë¬¸ì„ ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?";
            if(confirm(msg)) {
                await deleteDoc(doc(db, "orders", id));
            }
        }
    </script>
</body>
</html>
